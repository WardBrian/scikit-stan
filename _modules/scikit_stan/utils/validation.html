
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>scikit_stan.utils.validation &#8212; SciKit Stan  documentation</title>
  <script>
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=9b1a4fa89bdd0e95b23b" rel="stylesheet">
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=9b1a4fa89bdd0e95b23b" rel="stylesheet">

  
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/6.1.2/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=9b1a4fa89bdd0e95b23b">

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/scikit_stan/utils/validation';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="docsearch:language" content="en">
  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="">

  
  <input type="checkbox" class="sidebar-toggle" name="__primary" id="__primary">
  <label class="overlay overlay-primary" for="__primary"></label>

  
  <input type="checkbox" class="sidebar-toggle" name="__secondary" id="__secondary">
  <label class="overlay overlay-secondary" for="__secondary"></label>

  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
      
<form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
    </div>
  </div>

  
  <nav class="bd-header navbar navbar-expand-lg bd-navbar" id="navbar-main"><div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
      <span class="fas fa-bars"></span>
  </label>
  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="../../../index.html">

  
  
  
  
  
  
  

  
  
    <p class="title logo__title">SciKit Stan  documentation</p>
  
</a>
    
  </div>

  
  <div class="col-lg-9 navbar-header-items">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                <li class="nav-item">
                    <a class="nav-link" href="../../../getting-started.html">
                        Getting Started
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../../../api.html">
                        API Reference
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../../../examples.html">
                        Examples
                    </a>
                </li>
                
    </ul>
</nav>
      </div>
      
    </div>

    <div id="navbar-end">
      <div class="navbar-end-item navbar-end__search-button-container">
        
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search">
  <i class="fas fa-search"></i>
</button>
      </div>
      
      <div class="navbar-end-item">
        <span class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle">
    <a class="theme-switch" data-mode="light"><i class="fas fa-sun"></i></a>
    <a class="theme-switch" data-mode="dark"><i class="far fa-moon"></i></a>
    <a class="theme-switch" data-mode="auto"><i class="fas fa-adjust"></i></a>
</span>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          <a href="https://github.com/WardBrian/scikit-stan" title="GitHub" class="nav-link" rel="noopener" target="_blank"><span><i class="fab fa-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          <a href="https://discourse.mc-stan.org/" title="Forums" class="nav-link" rel="noopener" target="_blank"><span><i class="fas fa-users"></i></span>
            <label class="sr-only">Forums</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>


  
  <div class="search-button-container--mobile">
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search">
  <i class="fas fa-search"></i>
</button>
  </div>

  
  <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fas fa-outdent"></span>
  </label>
  

</div>
  </nav>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        
  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                <li class="nav-item">
                    <a class="nav-link" href="../../../getting-started.html">
                        Getting Started
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../../../api.html">
                        API Reference
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../../../examples.html">
                        Examples
                    </a>
                </li>
                
    </ul>
</nav>
      </div>
      
      </div>
    

    
    
    <div class="sidebar-header-items__end">
      
      <div class="navbar-end-item">
        <span class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle">
    <a class="theme-switch" data-mode="light"><i class="fas fa-sun"></i></a>
    <a class="theme-switch" data-mode="dark"><i class="far fa-moon"></i></a>
    <a class="theme-switch" data-mode="auto"><i class="fas fa-adjust"></i></a>
</span>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          <a href="https://github.com/WardBrian/scikit-stan" title="GitHub" class="nav-link" rel="noopener" target="_blank"><span><i class="fab fa-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          <a href="https://discourse.mc-stan.org/" title="Forums" class="nav-link" rel="noopener" target="_blank"><span><i class="fas fa-users"></i></span>
            <label class="sr-only">Forums</label></a>
        </li>
      </ul>
      </div>
      
    </div>
    
  </div>

  

  
  <div class="sidebar-end-items sidebar-primary__section">
    <div class="sidebar-end-items__item">
    </div>
  </div>

      </div>
      <main class="bd-main">
        
        
        <div class="bd-content">
          <div class="bd-article-container">
            
            <div class="bd-header-article">
                
            </div>
            
            
            <article class="bd-article" role="main">
              
  <h1>Source code for scikit_stan.utils.validation</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numbers</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">inspect</span> <span class="kn">import</span> <span class="n">isclass</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.sparse</span> <span class="k">as</span> <span class="nn">sp</span>
<span class="kn">from</span> <span class="nn">cmdstanpy</span> <span class="kn">import</span> <span class="n">CmdStanModel</span>
<span class="kn">from</span> <span class="nn">numpy.typing</span> <span class="kn">import</span> <span class="n">ArrayLike</span><span class="p">,</span> <span class="n">NDArray</span>

<span class="kn">from</span> <span class="nn">..exceptions</span> <span class="kn">import</span> <span class="n">NotFittedError</span>

<span class="n">GLM_FAMILIES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;gaussian&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;gamma&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;inverse-gaussian&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s2">&quot;poisson&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s2">&quot;binomial&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="s2">&quot;negative-binomial&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="s2">&quot;bernoulli&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
<span class="p">}</span>

<span class="sd">&quot;&quot;&quot; GENERAL LINK MAP</span>
<span class="sd">     identity - 0</span>
<span class="sd">     log - 1</span>
<span class="sd">     inverse - 2</span>
<span class="sd">     sqrt - 3</span>
<span class="sd">     inverse-square - 4</span>
<span class="sd">     logit - 5</span>
<span class="sd">     probit - 6</span>
<span class="sd">     cloglog - 7</span>
<span class="sd">     cauchit - 8</span>
<span class="sd">                    &quot;&quot;&quot;</span>

<span class="c1"># NOTE: linear model regression assumes constant variance,</span>

<span class="n">GAUSSIAN_LINKS</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;identity&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;log&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;inverse&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>


<span class="c1"># NOTE: the Gamma regression is on parameterized Gamma(mu, alpha)</span>
<span class="c1"># where alpha is considered fixed as linear models all assume constant variance</span>
<span class="n">GAMMA_LINKS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;identity&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;log&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;inverse&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
<span class="p">}</span>


<span class="n">INVERSE_GAUSSIAN_LINKS</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;identity&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;log&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;inverse&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;inverse-square&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}</span>


<span class="n">BINOMIAL_LINKS</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;log&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;logit&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;probit&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s2">&quot;cloglog&quot;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s2">&quot;cauchit&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">}</span>


<span class="n">POISSON_LINKS</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;identity&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;log&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;sqrt&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>


<span class="n">BERNOULLI_LINKS</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;logit&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;probit&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s2">&quot;cloglog&quot;</span><span class="p">:</span> <span class="mi">7</span><span class="p">}</span>


<span class="n">method_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;sample&quot;</span><span class="p">:</span> <span class="n">CmdStanModel</span><span class="o">.</span><span class="n">sample</span><span class="p">,</span>
    <span class="s2">&quot;optimize&quot;</span><span class="p">:</span> <span class="n">CmdStanModel</span><span class="o">.</span><span class="n">optimize</span><span class="p">,</span>
    <span class="s2">&quot;variational&quot;</span><span class="p">:</span> <span class="n">CmdStanModel</span><span class="o">.</span><span class="n">variational</span><span class="p">,</span>
<span class="p">}</span>


<span class="n">FAMILY_LINKS_MAP</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;gaussian&quot;</span><span class="p">:</span> <span class="n">GAUSSIAN_LINKS</span><span class="p">,</span>
    <span class="s2">&quot;binomial&quot;</span><span class="p">:</span> <span class="n">BINOMIAL_LINKS</span><span class="p">,</span>
    <span class="s2">&quot;gamma&quot;</span><span class="p">:</span> <span class="n">GAMMA_LINKS</span><span class="p">,</span>
    <span class="s2">&quot;poisson&quot;</span><span class="p">:</span> <span class="n">POISSON_LINKS</span><span class="p">,</span>
    <span class="s2">&quot;inverse-gaussian&quot;</span><span class="p">:</span> <span class="n">INVERSE_GAUSSIAN_LINKS</span><span class="p">,</span>
    <span class="c1"># &quot;binomial&quot; : BINOMIAL_LINKS</span>
    <span class="s2">&quot;bernoulli&quot;</span><span class="p">:</span> <span class="n">BERNOULLI_LINKS</span><span class="p">,</span>
<span class="p">}</span>


<span class="n">SLOPE_PRIOR_DEFAULTS_INFO</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;normal&quot;</span><span class="p">:</span> <span class="s2">&quot;normal(0, 2.5 * sd(y) / sd(X)) if Gaussian else normal(0, 2.5)&quot;</span><span class="p">,</span>
    <span class="c1"># NOTE: the laplace distribution is translation invariant</span>
    <span class="s2">&quot;laplace&quot;</span><span class="p">:</span> <span class="s2">&quot;laplace(0, 2.5)&quot;</span><span class="p">,</span>
<span class="p">}</span>


<span class="n">INTERCEPT_PRIOR_DEFAULTS_INFO</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;normal&quot;</span><span class="p">:</span> <span class="s2">&quot;normal(mu(y), 2.5 * sd(y)) if Gaussian else normal(0, 2.5)&quot;</span><span class="p">,</span>
    <span class="c1"># NOTE: the laplace distribution is translation invariant</span>
    <span class="s2">&quot;laplace&quot;</span><span class="p">:</span> <span class="s2">&quot;double_exponential(0, 2.5)&quot;</span><span class="p">,</span>
<span class="p">}</span>


<span class="n">PRIORS_MAP</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;normal&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1"># normal distribution, requires location (mu) and scale (sigma)</span>
    <span class="c1"># or else defaults to rstanarm&#39;s default:</span>
    <span class="c1"># https://cran.r-project.org/web/packages/rstanarm/vignettes/priors.html</span>
    <span class="s2">&quot;laplace&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># laplace distribution, requires location (mu) and scale (sigma)</span>
    <span class="c1"># or else defaults to double_exponential(0, 1)</span>
    <span class="c1"># for suggestions on this prior, refer to:</span>
    <span class="c1">#  https://www.jstor.org/stable/1403571#metadata_info_tab_contents</span>
<span class="p">}</span>

<span class="c1"># NOTE: these must be positive-valued distributions only</span>
<span class="n">PRIORS_AUX_MAP</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;exponential&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1"># exponential distribution, requires only beta parameter</span>
    <span class="s2">&quot;chi2&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># chi-squared distribution, requires only nu parameter</span>
    <span class="s2">&quot;gamma&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>  <span class="c1"># gamma distribution, requires only alpha and beta parameters</span>
    <span class="s2">&quot;inv_gamma&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>  <span class="c1"># inverse gamma distribution, requires only alpha and beta parameters</span>
<span class="p">}</span>


<span class="c1"># NOTE: family and link combinations match R families package</span>
<span class="c1"># package: https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/family</span>
<div class="viewcode-block" id="validate_family"><a class="viewcode-back" href="../../../internal_api.html#scikit_stan.utils.validation.validate_family">[docs]</a><span class="k">def</span> <span class="nf">validate_family</span><span class="p">(</span><span class="n">family</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">link</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Validate family and link combination choice.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    family : str</span>
<span class="sd">        Name of chosen family. Only the following families are supported:</span>
<span class="sd">        &quot;gaussian&quot;, &quot;binomial&quot;, &quot;gamma&quot;, &quot;poisson&quot;, &quot;inverse-gaussian&quot;.</span>
<span class="sd">    link : Optional[str]</span>
<span class="sd">        Name of chosen link function. Only the following combinations are supported,</span>
<span class="sd">        following the R families package:</span>

<span class="sd">            * &quot;gaussian&quot;:</span>
<span class="sd">                * &quot;identity&quot; - Identity link function,</span>
<span class="sd">                * &quot;log&quot; - Log link function,</span>
<span class="sd">                * &quot;inverse&quot; - Inverse link function</span>
<span class="sd">            * &quot;gamma&quot;:</span>
<span class="sd">                * &quot;identity&quot; - Identity link function,</span>
<span class="sd">                * &quot;log&quot; - Log link function,</span>
<span class="sd">                * &quot;inverse&quot; - Inverse link function</span>
<span class="sd">            * &quot;inverse-gaussian&quot;:</span>
<span class="sd">                * &quot;identity&quot; - Identity link function,</span>
<span class="sd">                * &quot;log&quot; - Log link function,</span>
<span class="sd">                * &quot;inverse&quot; - Inverse link function,</span>
<span class="sd">                * &quot;inverse-square&quot; - Inverse square link function</span>
<span class="sd">            * &quot;poisson&quot;:</span>
<span class="sd">                * &quot;identity&quot; - Identity link function,</span>
<span class="sd">                * &quot;log&quot; - Log link function,</span>
<span class="sd">                * &quot;sqrt&quot; - Square root link function</span>
<span class="sd">            * &quot;binomial&quot;:</span>
<span class="sd">                * &quot;log&quot; - Log link function,</span>
<span class="sd">                * &quot;logit&quot; - Logit link function,</span>
<span class="sd">                * &quot;probit&quot; - Probit link function,</span>
<span class="sd">                * &quot;cloglog&quot; - Complementary log-log link function,</span>
<span class="sd">                * &quot;cauchit&quot; - Cauchit link function</span>

<span class="sd">        If an invalid combination of family and link is passed, a ValueError is raised.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        Passed family is not supported.</span>
<span class="sd">    ValueError</span>
<span class="sd">        Passed link is not supported or is not valid for the chosen family.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">link</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Link function must be specified for family </span><span class="si">{</span><span class="n">family</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">family</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">FAMILY_LINKS_MAP</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Family </span><span class="si">{</span><span class="n">family</span><span class="si">}</span><span class="s2"> not supported.</span>
<span class="s2">            Supported families: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">FAMILY_LINKS_MAP</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">link</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">FAMILY_LINKS_MAP</span><span class="p">[</span><span class="n">family</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Link </span><span class="si">{</span><span class="n">link</span><span class="si">}</span><span class="s2"> not supported for family </span><span class="si">{</span><span class="n">family</span><span class="si">}</span><span class="s2">.</span>
<span class="s2">            These links are supported for </span><span class="si">{</span><span class="n">family</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">FAMILY_LINKS_MAP</span><span class="p">[</span><span class="n">family</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s2">.&quot;&quot;&quot;</span>
        <span class="p">)</span></div>


<span class="c1"># adapted from sklearn&#39;s data validation scheme which is distributed under the 3-Clause BSD License.</span>
<div class="viewcode-block" id="check_array"><a class="viewcode-back" href="../../../internal_api.html#scikit_stan.utils.validation.check_array">[docs]</a><span class="k">def</span> <span class="nf">check_array</span><span class="p">(</span>
    <span class="n">X</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span>
    <span class="n">ensure_2d</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">allow_nd</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">allow_sparse</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">dtype</span><span class="p">:</span> <span class="nb">type</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">NDArray</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">]],</span> <span class="n">sp</span><span class="o">.</span><span class="n">csr_matrix</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Input validation on an array, list, sparse matrix or similar.</span>
<span class="sd">    By default, the input is checked to be a non-empty 2D array containing</span>
<span class="sd">    only finite values.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    X : ArrayLike</span>
<span class="sd">        Array-like, list, sparse matrix, or similar of data to be checked.</span>
<span class="sd">    ensure_2d : bool, optional</span>
<span class="sd">        Whether to ensure that the array is 2D</span>
<span class="sd">    allow_nd : bool, optional</span>
<span class="sd">        Whether to allow the array to be an n-dimensional matrix where n &gt; 2</span>
<span class="sd">    dtype : type, optional</span>
<span class="sd">        Dtype of the data; regressions only supported on</span>
<span class="sd">        float64 or int64 arrays</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    NDArray[Union[np.float64, np.int64]]</span>
<span class="sd">        Verified set of data that can be used for regression.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        Sparse, complex, or otherwise invalid data type passed for X.</span>
<span class="sd">    ValueError</span>
<span class="sd">        Invalid number of dimensions in data passed for X, or otherwise data that</span>
<span class="sd">        cannot be recast to satisfy dimension requirements</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># NOTE: cmdstanpy automatically deals with Pandas dataframes</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">iscomplex</span><span class="p">(</span><span class="n">X</span><span class="p">)):</span>  <span class="c1"># type: ignore</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Complex data not supported.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">sp</span><span class="o">.</span><span class="n">issparse</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">allow_sparse</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">csr_matrix</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
            <span class="n">check_data</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sd">&quot;&quot;&quot;Estimator does not currently support sparse data</span>
<span class="sd">             entry; consider extracting with .todense()&quot;&quot;&quot;</span>
            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">check_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">check_data</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">check_data</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Input contains NaN.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">check_data</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Input contains infinity or a value too large for this estimator.&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">ensure_2d</span><span class="p">:</span>
        <span class="c1"># input cannot be scalar</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">if</span> <span class="n">shape</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Singleton array or empty array cannot be considered a valid collection.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">res</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;0 feature(s) (shape=(</span><span class="si">{</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, 0)) while a minimum of 1 &quot;</span>
                <span class="s2">&quot;is required.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">res</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Expected 2D array, got scalar array instead:</span><span class="se">\n</span><span class="s2">array=</span><span class="si">{</span><span class="n">X</span><span class="si">!r}</span><span class="s2">.</span><span class="se">\n</span><span class="s2"></span>
<span class="s2">                    Reshape your data either using array.reshape(-1, 1) if</span>
<span class="s2">                    your data has a single feature or array.reshape(1, -1)</span>
<span class="s2">                    if it contains a single sample.&quot;&quot;&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">res</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="sd">&quot;&quot;&quot;Passed data is one-dimensional, while estimator expects&quot;&quot;&quot;</span>
                <span class="o">+</span> <span class="s2">&quot;&quot;&quot; it to be at at least two-dimensional.&quot;&quot;&quot;</span>
            <span class="p">)</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asanyarray</span><span class="p">(</span><span class="n">X</span><span class="p">)[:,</span> <span class="kc">None</span><span class="p">]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">allow_nd</span> <span class="ow">and</span> <span class="n">res</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            Passed array with </span><span class="si">{</span><span class="n">res</span><span class="o">.</span><span class="n">ndim</span><span class="si">!r}</span><span class="s2"> dimensions. Estimator expected &lt;= 2.</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">res</span></div>


<span class="k">def</span> <span class="nf">_check_y</span><span class="p">(</span>
    <span class="n">y</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="nb">type</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">]]:</span>
    <span class="k">return</span> <span class="n">check_array</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">ensure_2d</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>


<span class="c1"># adapted from sklearn&#39;s check_X_y validation scheme which</span>
<span class="c1"># is distributed under the 3-Clause BSD License.</span>
<span class="k">def</span> <span class="nf">check_X_y</span><span class="p">(</span>
    <span class="n">X</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span>
    <span class="n">y</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span>
    <span class="n">ensure_X_2d</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">allow_nd</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">dtype</span><span class="p">:</span> <span class="nb">type</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">NDArray</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">]],</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">]]]:</span>
    <span class="n">X_checked</span> <span class="o">=</span> <span class="n">check_array</span><span class="p">(</span>
        <span class="n">X</span><span class="p">,</span> <span class="n">ensure_2d</span><span class="o">=</span><span class="n">ensure_X_2d</span><span class="p">,</span> <span class="n">allow_nd</span><span class="o">=</span><span class="n">allow_nd</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">allow_sparse</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="n">y_checked</span> <span class="o">=</span> <span class="n">_check_y</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">X_checked</span><span class="p">,</span> <span class="n">y_checked</span>


<span class="c1"># NOTE: This is derived from sk-learn&#39;s validation checks, which</span>
<span class="c1"># are distributed under the 3-Clause BSD License.</span>
<div class="viewcode-block" id="check_is_fitted"><a class="viewcode-back" href="../../../internal_api.html#scikit_stan.utils.validation.check_is_fitted">[docs]</a><span class="k">def</span> <span class="nf">check_is_fitted</span><span class="p">(</span>
    <span class="n">estimator</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="n">attributes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">msg</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">all_or_any</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">object</span><span class="p">]],</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="nb">all</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform is_fitted validation for estimator.</span>
<span class="sd">    Checks if the estimator is fitted by verifying the presence of</span>
<span class="sd">    fitted attributes (ending with a trailing underscore) and otherwise</span>
<span class="sd">    raises a NotFittedError with the given message.</span>
<span class="sd">    If an estimator does not set any attributes with a trailing underscore, it</span>
<span class="sd">    can define a ``__sklearn_is_fitted__`` method returning a boolean to specify</span>
<span class="sd">    if the estimator is fitted or not.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    estimator : estimator instance</span>
<span class="sd">        estimator instance for which the check is performed.</span>
<span class="sd">    attributes : str, list or tuple of str, default=None</span>
<span class="sd">        Attribute name(s) given as string or a list/tuple of strings</span>
<span class="sd">        Eg.: ``[&quot;coef_&quot;, &quot;estimator_&quot;, ...], &quot;coef_&quot;``</span>
<span class="sd">        If ``None``, ``estimator`` is considered fitted if there exist an</span>
<span class="sd">        attribute that ends with a underscore and does not start with double</span>
<span class="sd">        underscore.</span>
<span class="sd">    msg : str, default=None</span>
<span class="sd">        The default error message is, &quot;This %(name)s instance is not fitted</span>
<span class="sd">        yet. Call &#39;fit&#39; with appropriate arguments before using this</span>
<span class="sd">        estimator.&quot;</span>
<span class="sd">        For custom messages if &quot;%(name)s&quot; is present in the message string,</span>
<span class="sd">        it is substituted for the estimator name.</span>
<span class="sd">        Eg. : &quot;Estimator, %(name)s, must be fitted before sparsifying&quot;.</span>
<span class="sd">    all_or_any : callable, {all, any}, default=all</span>
<span class="sd">        Specify whether all or any of the given attributes must exist.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    NotFittedError</span>
<span class="sd">        If the attributes are not found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">isclass</span><span class="p">(</span><span class="n">estimator</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> is a class, not an instance.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">estimator</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">msg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;This </span><span class="si">%(name)s</span><span class="s2"> instance is not fitted yet. Call &#39;fit&#39; with &quot;</span>
            <span class="s2">&quot;appropriate arguments before using this estimator.&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span> <span class="s2">&quot;fit&quot;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> is not an estimator instance.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">estimator</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">attributes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attributes</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">attributes</span> <span class="o">=</span> <span class="p">[</span><span class="n">attributes</span><span class="p">]</span>
        <span class="n">fitted</span> <span class="o">=</span> <span class="n">all_or_any</span><span class="p">([</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span> <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">attributes</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span> <span class="s2">&quot;is_fitted_&quot;</span><span class="p">):</span>
            <span class="n">fitted</span> <span class="o">=</span> <span class="n">estimator</span><span class="o">.</span><span class="n">is_fitted_</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> has no field is_fitted_, does not conform to required API&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">estimator</span>
                <span class="p">)</span>
            <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">fitted</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">NotFittedError</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="n">estimator</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">})</span></div>


<div class="viewcode-block" id="check_consistent_length"><a class="viewcode-back" href="../../../internal_api.html#scikit_stan.utils.validation.check_consistent_length">[docs]</a><span class="k">def</span> <span class="nf">check_consistent_length</span><span class="p">(</span><span class="o">*</span><span class="n">arrays</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Check that all arrays have consistent first dimensions.</span>
<span class="sd">    Checks whether all objects in arrays have the same shape or length.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    *arrays : list or tuple of input objects.</span>
<span class="sd">        Objects that will be checked for consistent length.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">lengths</span> <span class="o">=</span> <span class="p">[</span><span class="n">_num_samples</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="k">for</span> <span class="n">X</span> <span class="ow">in</span> <span class="n">arrays</span> <span class="k">if</span> <span class="n">X</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
    <span class="n">uniques</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int_</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">lengths</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">uniques</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Found input variables with inconsistent numbers of samples: </span><span class="si">%r</span><span class="s2">&quot;</span>
            <span class="o">%</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">lgth</span><span class="p">)</span> <span class="k">for</span> <span class="n">lgth</span> <span class="ow">in</span> <span class="n">lengths</span><span class="p">]</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="_num_samples"><a class="viewcode-back" href="../../../internal_api.html#scikit_stan.utils.validation._num_samples">[docs]</a><span class="k">def</span> <span class="nf">_num_samples</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Integral</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Return number of samples in array-like x.&quot;&quot;&quot;</span>
    <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Expected sequence or array-like, got </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;fit&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">callable</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">fit</span><span class="p">):</span>
        <span class="c1"># Don&#39;t get num_samples from an ensembles length!</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;__len__&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;shape&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;__array__&quot;</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;shape&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;Singleton array </span><span class="si">%r</span><span class="s2"> cannot be considered a valid collection.&quot;</span> <span class="o">%</span> <span class="n">x</span>
            <span class="p">)</span>
        <span class="c1"># Check that shape is returning an integer or default to len</span>
        <span class="c1"># Dask dataframes may not return numeric shape[0] value</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Integral</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">type_error</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">type_error</span></div>


<div class="viewcode-block" id="validate_prior"><a class="viewcode-back" href="../../../internal_api.html#scikit_stan.utils.validation.validate_prior">[docs]</a><span class="k">def</span> <span class="nf">validate_prior</span><span class="p">(</span><span class="n">prior_spec</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">coeff_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform validation on given prior dictionary for prior on either slope or intercept.</span>
<span class="sd">    This is only called when there is a prior to check.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    prior_spec : Dict[str, Any]</span>
<span class="sd">        Proposed prior dictionary, can be either for slope or intercept.</span>
<span class="sd">    coeff_type : str</span>
<span class="sd">        Specify whether the prior is for slope or intercept - should only be</span>
<span class="sd">        &#39;slope&#39; or &#39;intercept&#39;.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Dict[str, Any]</span>
<span class="sd">        Validated dictionary of parameters for the given prior.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        Validating a non-(slope or intercept) prior type.</span>
<span class="sd">    ValueError</span>
<span class="sd">        Prior distribution is not specified.</span>
<span class="sd">    ValueError</span>
<span class="sd">        Not all parameters for prior set-up are specified.</span>
<span class="sd">    ValueError</span>
<span class="sd">        Prior sigma is negative.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">coeff_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;slope&quot;</span><span class="p">,</span> <span class="s2">&quot;intercept&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;coeff_type should be either &#39;slope&#39; or &#39;intercept&#39;, &quot;</span>
            <span class="s2">&quot;got </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">coeff_type</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="n">config_keys</span> <span class="o">=</span> <span class="n">prior_spec</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

    <span class="k">if</span> <span class="s2">&quot;prior_&quot;</span> <span class="o">+</span> <span class="n">coeff_type</span> <span class="o">+</span> <span class="s2">&quot;_dist&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">config_keys</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;prior_</span><span class="si">{</span><span class="n">coeff_type</span><span class="si">}</span><span class="s2">_dist must be specified in prior given by </span><span class="si">{</span><span class="n">prior_spec</span><span class="si">}</span><span class="s2">.&quot;&quot;&quot;</span>
        <span class="p">)</span>

    <span class="n">dist_key</span> <span class="o">=</span> <span class="n">prior_spec</span><span class="p">[</span><span class="s2">&quot;prior_&quot;</span> <span class="o">+</span> <span class="n">coeff_type</span> <span class="o">+</span> <span class="s2">&quot;_dist&quot;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">dist_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">PRIORS_MAP</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Prior </span><span class="si">{</span><span class="n">dist_key</span><span class="si">}</span><span class="s2"> in prior specification </span><span class="si">{</span><span class="n">prior_spec</span><span class="si">}</span><span class="s2"> not supported.&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;prior_&quot;</span> <span class="o">+</span> <span class="n">coeff_type</span> <span class="o">+</span> <span class="s2">&quot;_mu&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">config_keys</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;prior_</span><span class="si">{</span><span class="n">coeff_type</span><span class="si">}</span><span class="s2">_mu must be specified in prior given by </span><span class="si">{</span><span class="n">prior_spec</span><span class="si">}</span><span class="s2">.&quot;&quot;&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;prior_&quot;</span> <span class="o">+</span> <span class="n">coeff_type</span> <span class="o">+</span> <span class="s2">&quot;_sigma&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">config_keys</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;prior_</span><span class="si">{</span><span class="n">coeff_type</span><span class="si">}</span><span class="s2">_sigma must be specified in prior given by </span><span class="si">{</span><span class="n">prior_spec</span><span class="si">}</span><span class="s2">.&quot;&quot;&quot;</span>
        <span class="p">)</span>

    <span class="n">sigmas</span> <span class="o">=</span> <span class="n">prior_spec</span><span class="p">[</span><span class="s2">&quot;prior_&quot;</span> <span class="o">+</span> <span class="n">coeff_type</span> <span class="o">+</span> <span class="s2">&quot;_sigma&quot;</span><span class="p">]</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sigmas</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sigmas</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;prior_</span><span class="si">{</span><span class="n">coeff_type</span><span class="si">}</span><span class="s2">_sigma must be positive in prior given by </span><span class="si">{</span><span class="n">prior_spec</span><span class="si">}</span><span class="s2">.&quot;&quot;&quot;</span>
            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">sigmas</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;prior_</span><span class="si">{</span><span class="n">coeff_type</span><span class="si">}</span><span class="s2">_sigma must be positive in prior given by </span><span class="si">{</span><span class="n">prior_spec</span><span class="si">}</span><span class="s2">.&quot;&quot;&quot;</span>
            <span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;prior_&quot;</span> <span class="o">+</span> <span class="n">coeff_type</span> <span class="o">+</span> <span class="s2">&quot;_dist&quot;</span><span class="p">:</span> <span class="n">PRIORS_MAP</span><span class="p">[</span><span class="n">dist_key</span><span class="p">],</span>
        <span class="s2">&quot;prior_&quot;</span> <span class="o">+</span> <span class="n">coeff_type</span> <span class="o">+</span> <span class="s2">&quot;_mu&quot;</span><span class="p">:</span> <span class="n">prior_spec</span><span class="p">[</span><span class="s2">&quot;prior_&quot;</span> <span class="o">+</span> <span class="n">coeff_type</span> <span class="o">+</span> <span class="s2">&quot;_mu&quot;</span><span class="p">],</span>
        <span class="s2">&quot;prior_&quot;</span> <span class="o">+</span> <span class="n">coeff_type</span> <span class="o">+</span> <span class="s2">&quot;_sigma&quot;</span><span class="p">:</span> <span class="n">prior_spec</span><span class="p">[</span><span class="s2">&quot;prior_&quot;</span> <span class="o">+</span> <span class="n">coeff_type</span> <span class="o">+</span> <span class="s2">&quot;_sigma&quot;</span><span class="p">],</span>
    <span class="p">}</span></div>


<div class="viewcode-block" id="validate_aux_prior"><a class="viewcode-back" href="../../../internal_api.html#scikit_stan.utils.validation.validate_aux_prior">[docs]</a><span class="k">def</span> <span class="nf">validate_aux_prior</span><span class="p">(</span><span class="n">aux_prior_spec</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validates passed configuration for prior on auxiliary parameters.</span>
<span class="sd">    This does not perform parameter autoscaling.</span>

<span class="sd">    This validation method returns the following fields in the dictionary:</span>

<span class="sd">        * &quot;prior_aux_dist&quot;: distribution of the prior on auxiliary parameters from this mapping:</span>
<span class="sd">            PRIORS_AUX_MAP = {</span>
<span class="sd">                        &quot;exponential&quot;: 0,  # exponential distribution, requires only beta parameter</span>
<span class="sd">                        &quot;chi2&quot;: 1,  # chi-squared distribution, requires only nu parameter</span>
<span class="sd">                        &quot;gamma&quot;: 2,  # gamma distribution, requires only alpha and beta parameters</span>
<span class="sd">                        &quot;inv_gamma&quot;: 3,</span>
<span class="sd">                        # inverse gamma distribution, requires only alpha and beta parameters</span>
<span class="sd">                        }</span>
<span class="sd">        * &quot;num_prior_aux_params&quot;: number of parameters in the prior on auxiliary parameters,</span>
<span class="sd">            determined by the number of parameters in the distribution.</span>
<span class="sd">        * &quot;prior_aux_params&quot;: list of parameters in the prior on auxiliary parameters;</span>
<span class="sd">                            this must be a list even if the distribution only has one parameter</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    aux_prior_spec : Dict[str, Any]</span>
<span class="sd">        Dictionary containing configuration for prior on auxiliary parameters.</span>
<span class="sd">        Currently supported priors are: &quot;exponential&quot; and &quot;chi2&quot;, which are</span>
<span class="sd">        both parameterized by a single scalar.</span>

<span class="sd">        Priors here with more parameters are a future feature.</span>
<span class="sd">        For single-parameter priors, this field is a dictionary with the following keys</span>

<span class="sd">            + &quot;prior_aux_dist&quot;: distribution of the prior on this parameter</span>
<span class="sd">            + &quot;prior_aux_param&quot;: parameter of the prior on this parameter</span>

<span class="sd">        For example, to specify a chi2 prior with nu=2.5, pass::</span>

<span class="sd">            {&quot;prior_aux_dist&quot;: &quot;chi2&quot;, &quot;prior_aux_param&quot;: 2.5}</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Dict[str, Any]</span>
<span class="sd">        Dictionary containing validated configuration for prior on auxiliary parameters.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        Prior&#39;s distribution is not specified.</span>
<span class="sd">    ValueError</span>
<span class="sd">        Unsupported prior distribution for auxiliary parameter.</span>
<span class="sd">    ValueError</span>
<span class="sd">        Prior distribution parameters are not specified.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">config_keys</span> <span class="o">=</span> <span class="n">aux_prior_spec</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

    <span class="k">if</span> <span class="s2">&quot;prior_aux_dist&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">config_keys</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;prior_aux_dist must be specified in auxiliary prior given by </span><span class="si">{</span><span class="n">aux_prior_spec</span><span class="si">}</span><span class="s2">.&quot;&quot;&quot;</span>
        <span class="p">)</span>

    <span class="n">dist_key</span> <span class="o">=</span> <span class="n">aux_prior_spec</span><span class="p">[</span><span class="s2">&quot;prior_aux_dist&quot;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">dist_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">PRIORS_AUX_MAP</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Prior </span><span class="si">{</span><span class="n">dist_key</span><span class="si">}</span><span class="s2"> in auxiliary prior specification </span><span class="si">{</span><span class="n">aux_prior_spec</span><span class="si">}</span><span class="s2"> not supported.&quot;</span>
        <span class="p">)</span>

    <span class="n">prior_aux_clean</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;prior_aux_dist&quot;</span><span class="p">:</span> <span class="n">PRIORS_AUX_MAP</span><span class="p">[</span><span class="n">dist_key</span><span class="p">],</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="n">dist_key</span> <span class="o">==</span> <span class="s2">&quot;exponential&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;beta&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">config_keys</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;beta must be specified in</span>
<span class="s2">                exponential auxiliary parameter prior given by </span><span class="si">{</span><span class="n">aux_prior_spec</span><span class="si">}</span><span class="s2">.&quot;&quot;&quot;</span>
            <span class="p">)</span>

        <span class="n">prior_aux_clean</span><span class="p">[</span><span class="s2">&quot;num_prior_aux_params&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">prior_aux_clean</span><span class="p">[</span><span class="s2">&quot;prior_aux_params&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">aux_prior_spec</span><span class="p">[</span><span class="s2">&quot;beta&quot;</span><span class="p">]]</span>
    <span class="k">elif</span> <span class="n">dist_key</span> <span class="o">==</span> <span class="s2">&quot;chi2&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;nu&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">config_keys</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;nu must be specified in</span>
<span class="s2">                chi2 auxiliary parameter prior given by </span><span class="si">{</span><span class="n">aux_prior_spec</span><span class="si">}</span><span class="s2">.&quot;&quot;&quot;</span>
            <span class="p">)</span>

        <span class="n">prior_aux_clean</span><span class="p">[</span><span class="s2">&quot;num_prior_aux_params&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">prior_aux_clean</span><span class="p">[</span><span class="s2">&quot;prior_aux_params&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">aux_prior_spec</span><span class="p">[</span><span class="s2">&quot;nu&quot;</span><span class="p">]]</span>
    <span class="k">elif</span> <span class="n">dist_key</span> <span class="o">==</span> <span class="s2">&quot;gamma&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="s2">&quot;beta&quot;</span> <span class="ow">in</span> <span class="n">config_keys</span> <span class="ow">and</span> <span class="s2">&quot;alpha&quot;</span> <span class="ow">in</span> <span class="n">config_keys</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;alpha and beta must be specified in</span>
<span class="s2">                gamma auxiliary parameter prior given by </span><span class="si">{</span><span class="n">aux_prior_spec</span><span class="si">}</span><span class="s2">.&quot;&quot;&quot;</span>
            <span class="p">)</span>

        <span class="n">prior_aux_clean</span><span class="p">[</span><span class="s2">&quot;num_prior_aux_params&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">prior_aux_clean</span><span class="p">[</span><span class="s2">&quot;prior_aux_params&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">aux_prior_spec</span><span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">],</span>
            <span class="n">aux_prior_spec</span><span class="p">[</span><span class="s2">&quot;beta&quot;</span><span class="p">],</span>
        <span class="p">]</span>
    <span class="k">elif</span> <span class="n">dist_key</span> <span class="o">==</span> <span class="s2">&quot;inv_gamma&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="s2">&quot;beta&quot;</span> <span class="ow">in</span> <span class="n">config_keys</span> <span class="ow">and</span> <span class="s2">&quot;alpha&quot;</span> <span class="ow">in</span> <span class="n">config_keys</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;alpha and beta must be specified in</span>
<span class="s2">                gamma auxiliary parameter prior given by </span><span class="si">{</span><span class="n">aux_prior_spec</span><span class="si">}</span><span class="s2">.&quot;&quot;&quot;</span>
            <span class="p">)</span>

        <span class="n">prior_aux_clean</span><span class="p">[</span><span class="s2">&quot;num_prior_aux_params&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">prior_aux_clean</span><span class="p">[</span><span class="s2">&quot;prior_aux_params&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">aux_prior_spec</span><span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">],</span>
            <span class="n">aux_prior_spec</span><span class="p">[</span><span class="s2">&quot;beta&quot;</span><span class="p">],</span>
        <span class="p">]</span>

    <span class="k">return</span> <span class="n">prior_aux_clean</span></div>
</pre></div>

            </article>
            
            
            
            <footer class="bd-footer-article">
                <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
            </footer>
            
          </div>
          
          
          
            <div class="bd-sidebar-secondary bd-toc">
              
<div class="toc-item">
  
</div>

<div class="toc-item">
  
</div>

            </div>
          
          
        </div>
        <footer class="bd-footer-content">
          <div class="bd-footer-content__inner">
            
          </div>
        </footer>
        
      </main>
    </div>
  </div>

  
    
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=9b1a4fa89bdd0e95b23b"></script>

  <footer class="bd-footer"><div class="bd-footer__inner container">
  
  <div class="footer-item">
    
<p class="copyright">

    &copy; Copyright 2022, Alexey Izmailov, Brian Ward.<br>

</p>

  </div>
  
  <div class="footer-item">
    
<p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.1.1.<br>
</p>

  </div>
  
</div>
  </footer>
  </body>
</html>